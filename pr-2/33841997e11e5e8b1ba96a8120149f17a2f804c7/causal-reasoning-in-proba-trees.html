<!DOCTYPE html>
<!--
    So Simple Jekyll Theme 3.2.0
    Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
    Free for personal and commercial use under the MIT license
    https://github.com/mmistakes/so-simple-theme/blob/master/LICENSE
-->
<html lang="en-US" class="no-js">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  

  
    <title>Algorithms for Causal Reasoning in Probability Trees</title>
    <meta name="description" content="Discrete Probability Trees (or Staged Tree Models) are one of the simplest models of causal generative processes, different from Causal Bayesian Networks (CB...">
    <link rel="canonical" href="https://tkukurin.github.io/causal-reasoning-in-proba-trees">
  

  <script>
    /* Cut the mustard */
    if ( 'querySelector' in document && 'addEventListener' in window ) {
      document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + 'js';
    }
  </script>

  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/skins/light.css">
  <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

</head>


  <body class="layout--post  algorithms-for-causal-reasoning-in-probability-trees">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#primary-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

    <header class="masthead">
  <div class="wrap">
    
    
    
      
        <div class="site-title animated fadeIn"><a href="/">~</a></div>
      
      <p class="site-description animated fadeIn" itemprop="description">caveat emptor</p>
    
  </div>
</header><!-- /.masthead -->


    <main id="main" class="main-content" aria-label="Content">
  <article class="h-entry">
    

    <div class="page-wrapper">
      <div class="page-sidebar">
        
            
            <h1 id="page-title" class="page-title p-name">Algorithms for Causal Reasoning in Probability Trees
</h1>
        
        <div class="page-author h-card p-author"><div class="author-info">
    <time class="page-date dt-published" datetime="2020-11-11T00:00:00+00:00"><a class="u-url" href="">Nov 11, 2020</a>
</time>

  </div>
</div>

        

        
  <h3 class="page-taxonomies-title">Tags</h3>
  <ul class="page-taxonomies"><li class="page-taxonomy">causality</li><li class="page-taxonomy">research</li>
  </ul>


      </div>

      <div class="page-content">
        <div class="e-content">
          <p>Discrete Probability Trees (or Staged Tree Models) are one of the simplest models of causal generative processes, different from Causal Bayesian Networks (CBNs) and Structural Causal Models (SCMs).</p>

<p>A directed edge \(e=(h,t)\) between two nodes in this graph is interpreted as the head being the cause of the tail.
Every node is a collection of statements.</p>

<p>Their implementation is quite simple, as most algorithms can be mapped almost 1:1 from the paper. Based on <a href="https://arxiv.org/pdf/2010.12237.pdf">Algorithms for Causal Reasoning in Probability Trees</a>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">dataclasses</span> <span class="k">as</span> <span class="n">dc</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Tuple</span>
</code></pre></div></div>

<p>They represent PT nodes as \(n=(u,S,C)\): unique identifier, list of statements (e.g. <code class="language-plaintext highlighter-rouge">W=rainy</code> and <code class="language-plaintext highlighter-rouge">X=0</code>) and a set of transitions.</p>

<blockquote>
  <p>A (total) realization in the probability tree is a path from the root to a leaf, and its probability is obtained by multiplying the transition probabilities along the path; and a partial realization is any connected sub-path within a total realization.</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Stmt</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">'Stmt'</span><span class="p">,</span> <span class="s">'var val'</span><span class="p">)</span>

<span class="o">@</span><span class="n">dc</span><span class="p">.</span><span class="n">dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>  <span class="c1"># (u, S, C)
</span>  <span class="k">class</span> <span class="nc">Children</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="k">pass</span>

  <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
  <span class="n">stmts</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Stmt</span><span class="p">]</span> <span class="o">=</span> <span class="n">dc</span><span class="p">.</span><span class="n">field</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
  <span class="n">childs</span><span class="p">:</span> <span class="n">Children</span> <span class="o">=</span> <span class="n">dc</span><span class="p">.</span><span class="n">field</span><span class="p">(</span>
    <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">childs</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">Children</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">childs</span><span class="p">)</span>
    <span class="nb">object</span><span class="p">.</span><span class="n">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">'childs'</span><span class="p">,</span> <span class="n">childs</span><span class="p">)</span>
</code></pre></div></div>

<p>Min-cut is a collection of nodes with <strong>probabilities summing up to 1</strong> (minimal set of nodes which determines whether an event occured).
The associated <strong>critical set</strong> determines whether an event won’t occur (false set parents).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">NULL</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">()</span>
<span class="n">MinCut</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">'MinCut'</span><span class="p">,</span> <span class="s">'T F'</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">(</span><span class="n">NULL</span><span class="p">,</span> <span class="n">NULL</span><span class="p">))</span>
</code></pre></div></div>

<p>For a simple statement, its min-cut is the node containing that statement.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">prop</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="n">Stmt</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">n</span><span class="p">.</span><span class="n">stmts</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">var</span> <span class="o">==</span> <span class="n">s</span><span class="p">.</span><span class="n">var</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">MinCut</span><span class="p">(</span>
        <span class="c1"># shitty pro-tip: impress people by showing you
</span>        <span class="c1"># can construct Python sets using literals
</span>        <span class="n">T</span><span class="o">=</span><span class="p">{</span><span class="n">n</span><span class="p">.</span><span class="nb">id</span><span class="p">}</span> <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">s</span><span class="p">.</span><span class="n">val</span> <span class="k">else</span> <span class="p">{</span><span class="o">*</span><span class="p">()},</span>
        <span class="n">F</span><span class="o">=</span><span class="p">{</span><span class="o">*</span><span class="p">()}</span> <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">s</span><span class="p">.</span><span class="n">val</span> <span class="k">else</span> <span class="p">{</span><span class="n">n</span><span class="p">.</span><span class="nb">id</span><span class="p">})</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">.</span><span class="n">childs</span><span class="p">:</span>
    <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="s">'Cannot be resolved'</span><span class="p">)</span>
  <span class="n">T</span><span class="p">,</span> <span class="n">F</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">pc</span><span class="p">,</span> <span class="n">nc</span> <span class="ow">in</span> <span class="n">n</span><span class="p">.</span><span class="n">childs</span><span class="p">:</span>
    <span class="n">Tc</span><span class="p">,</span> <span class="n">Fc</span> <span class="o">=</span> <span class="n">prop</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">T</span><span class="p">,</span> <span class="n">F</span> <span class="o">=</span> <span class="n">T</span><span class="o">|</span><span class="n">Tc</span><span class="p">,</span> <span class="n">F</span><span class="o">|</span><span class="n">Fc</span>
  <span class="k">return</span> <span class="n">MinCut</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">F</span><span class="o">=</span><span class="n">F</span><span class="p">)</span>
</code></pre></div></div>

<p>Standard conjunction/disjunction/negation.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">and_</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">d1</span><span class="p">:</span> <span class="n">MinCut</span><span class="p">,</span> <span class="n">d2</span><span class="p">:</span> <span class="n">MinCut</span><span class="p">,</span>
         <span class="n">found1</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">found2</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">n</span><span class="p">.</span><span class="nb">id</span> <span class="ow">in</span> <span class="p">(</span><span class="n">d1</span><span class="p">.</span><span class="n">F</span><span class="o">|</span><span class="n">d2</span><span class="p">.</span><span class="n">F</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">MinCut</span><span class="p">(</span><span class="n">F</span><span class="o">=</span><span class="p">{</span><span class="n">n</span><span class="p">.</span><span class="nb">id</span><span class="p">})</span>
  <span class="k">if</span> <span class="n">n</span><span class="p">.</span><span class="nb">id</span> <span class="ow">in</span> <span class="n">d1</span><span class="p">.</span><span class="n">T</span><span class="p">:</span> <span class="n">found1</span> <span class="o">=</span> <span class="bp">True</span>
  <span class="k">if</span> <span class="n">n</span><span class="p">.</span><span class="nb">id</span> <span class="ow">in</span> <span class="n">d2</span><span class="p">.</span><span class="n">T</span><span class="p">:</span> <span class="n">found2</span> <span class="o">=</span> <span class="bp">True</span>
  <span class="k">if</span> <span class="n">found1</span> <span class="ow">and</span> <span class="n">found2</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">MinCut</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="p">{</span><span class="n">n</span><span class="p">.</span><span class="nb">id</span><span class="p">})</span>
  <span class="n">T</span><span class="p">,</span> <span class="n">F</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">pc</span><span class="p">,</span> <span class="n">nc</span> <span class="ow">in</span> <span class="n">n</span><span class="p">.</span><span class="n">childs</span><span class="p">:</span>
    <span class="n">Tc</span><span class="p">,</span> <span class="n">Fc</span> <span class="o">=</span> <span class="n">and_</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">found1</span><span class="p">,</span> <span class="n">found2</span><span class="p">)</span>
    <span class="n">T</span><span class="p">,</span> <span class="n">F</span> <span class="o">=</span> <span class="n">T</span><span class="o">|</span><span class="n">Tc</span><span class="p">,</span> <span class="n">F</span><span class="o">|</span><span class="n">Fc</span>
  <span class="k">return</span> <span class="n">MinCut</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">not_</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">MinCut</span><span class="p">):</span>
  <span class="c1"># Just swap true and false sets.
</span>  <span class="k">return</span> <span class="n">MinCut</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">d</span><span class="p">.</span><span class="n">F</span><span class="p">,</span> <span class="n">F</span><span class="o">=</span><span class="n">d</span><span class="p">.</span><span class="n">T</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">or_</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">d1</span><span class="p">:</span> <span class="n">MinCut</span><span class="p">,</span> <span class="n">d2</span><span class="p">:</span> <span class="n">MinCut</span><span class="p">):</span>
  <span class="c1"># De Morgan
</span>  <span class="k">return</span> <span class="n">not_</span><span class="p">(</span><span class="n">and_</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">not_</span><span class="p">(</span><span class="n">d1</span><span class="p">),</span> <span class="n">not_</span><span class="p">(</span><span class="n">d2</span><span class="p">)))</span>
</code></pre></div></div>

<p>Precedence relation takes min-cuts of its cause and effect.
Return all paths where cause precedes effect.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">prec</span><span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="n">Node</span><span class="p">,</span> <span class="n">dc</span><span class="p">:</span><span class="n">MinCut</span><span class="p">,</span> <span class="n">de</span><span class="p">:</span><span class="n">MinCut</span><span class="p">,</span> <span class="n">is_cause_subtree</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MinCut</span><span class="p">:</span>
  <span class="s">'''A&lt;B precedence relation.
  @param dc: cause
  @param de: effect
  @return min-cut for the event where precedence holds.
  '''</span>
  <span class="k">if</span> <span class="n">is_cause_subtree</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">n</span><span class="p">.</span><span class="nb">id</span> <span class="ow">in</span> <span class="n">dc</span><span class="p">.</span><span class="n">T</span><span class="p">:</span> <span class="k">return</span> <span class="n">MinCut</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="p">{</span><span class="n">n</span><span class="p">.</span><span class="nb">id</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">n</span><span class="p">.</span><span class="nb">id</span> <span class="ow">in</span> <span class="n">dc</span><span class="p">.</span><span class="n">F</span><span class="p">:</span> <span class="k">return</span> <span class="n">MinCut</span><span class="p">(</span><span class="n">F</span><span class="o">=</span><span class="p">{</span><span class="n">n</span><span class="p">.</span><span class="nb">id</span><span class="p">})</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="c1"># if cause does not preced current node
</span>    <span class="c1"># and current node is in the effect,
</span>    <span class="c1"># then this is not part of the mincut.
</span>    <span class="k">if</span> <span class="n">n</span><span class="p">.</span><span class="nb">id</span> <span class="ow">in</span> <span class="p">(</span><span class="n">de</span><span class="p">.</span><span class="n">T</span><span class="o">|</span><span class="n">dc</span><span class="p">.</span><span class="n">F</span><span class="o">|</span><span class="n">de</span><span class="p">.</span><span class="n">F</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">MinCut</span><span class="p">(</span><span class="n">F</span><span class="o">=</span><span class="p">{</span><span class="n">n</span><span class="p">.</span><span class="nb">id</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">n</span><span class="p">.</span><span class="nb">id</span> <span class="ow">in</span> <span class="n">dc</span><span class="p">.</span><span class="n">T</span><span class="p">:</span>
      <span class="n">is_cause_subtree</span> <span class="o">=</span> <span class="bp">True</span>
  <span class="n">T</span><span class="p">,</span> <span class="n">F</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">pc</span><span class="p">,</span> <span class="n">nc</span> <span class="ow">in</span> <span class="n">n</span><span class="p">.</span><span class="n">childs</span><span class="p">:</span>
    <span class="n">Tc</span><span class="p">,</span> <span class="n">Fc</span> <span class="o">=</span> <span class="n">prec</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">dc</span><span class="p">,</span> <span class="n">de</span><span class="p">,</span> <span class="n">is_cause_subtree</span><span class="p">)</span>
    <span class="n">T</span><span class="p">,</span> <span class="n">F</span> <span class="o">=</span> <span class="n">T</span><span class="o">|</span><span class="n">Tc</span><span class="p">,</span> <span class="n">F</span><span class="o">|</span><span class="n">Fc</span>
  <span class="k">return</span> <span class="n">MinCut</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
</code></pre></div></div>

<p>Conditioning updates the tree after an event is revealed to be true.
For example, “What is the probability of recovery given that a patient has taken the treatment?”</p>

\[P(R=1|T=1)\]

<p>Algorithm just removes all probability mass from the false min cut in <code class="language-plaintext highlighter-rouge">d</code>, and normalizes probabilities across the rest of the tree.</p>

<p><img src="http://www.adaptiveagents.org/_media/wiki/see.png" alt="See" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">see</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">MinCut</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
  <span class="s">'''P(A|B) :: proba of A, given B.
  @param n: reference proba tree
  @param d: observed event
  @return root of the new proba tree
  '''</span>
  <span class="k">def</span> <span class="nf">_see</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">MinCut</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span><span class="p">.</span><span class="nb">id</span> <span class="ow">in</span> <span class="n">d</span><span class="p">.</span><span class="n">T</span><span class="p">:</span> <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">q</span>
    <span class="k">if</span> <span class="n">n</span><span class="p">.</span><span class="nb">id</span> <span class="ow">in</span> <span class="n">d</span><span class="p">.</span><span class="n">F</span><span class="p">:</span> <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">D</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">sl</span><span class="p">,</span> <span class="n">sp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">pc</span><span class="p">,</span> <span class="n">nc</span> <span class="ow">in</span> <span class="n">n</span><span class="p">.</span><span class="n">childs</span><span class="p">:</span>
      <span class="n">nc</span><span class="p">,</span> <span class="n">lc</span><span class="p">,</span> <span class="n">pc</span> <span class="o">=</span> <span class="n">_see</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">pc</span><span class="o">*</span><span class="n">q</span><span class="p">)</span>
      <span class="n">D</span> <span class="o">|=</span> <span class="p">{(</span><span class="n">nc</span><span class="p">,</span><span class="n">lc</span><span class="p">,</span><span class="n">pc</span><span class="p">)}</span>
      <span class="n">sl</span> <span class="o">+=</span> <span class="n">lc</span>
      <span class="n">sp</span> <span class="o">+=</span> <span class="n">pc</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">sl</span><span class="p">,</span> <span class="n">sp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Node</span><span class="p">(</span><span class="n">n</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">n</span><span class="p">.</span><span class="n">stmts</span><span class="p">,</span> <span class="n">C</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sp</span>
  <span class="k">return</span> <span class="n">_see</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>

<p>Intervening is the act of minimally changing the transition probabilities in order to bring about a desired event with probability one. For example, “What is the probability of having the disease given that I take the drug and observe a recovery?”</p>

\[P(D=1|T\leftarrow1 \wedge R=1)\]

<blockquote>
  <p>depending on the critical set, the intervention could assign different values to the same random variables in separate branches of the tree, or in fact even manipulate different random variables in every branch (a context-dependent “recipe”), in order to bring about a desired effect.</p>
</blockquote>

<p><img src="http://www.adaptiveagents.org/_media/wiki/do.png" alt="Do" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">do</span><span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="n">Node</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span><span class="n">MinCut</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
  <span class="s">'''P(A|do(B)) :: proba of A, given B was made true.
  @param n: reference proba tree
  @param d: intervened event (do(B)); i.e. a set of variables
    we set to specific values via intervention.
  @return root of the new proba tree
  '''</span>
  <span class="k">def</span> <span class="nf">_do</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span><span class="n">MinCut</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span><span class="p">.</span><span class="nb">id</span> <span class="ow">in</span> <span class="n">d</span><span class="p">.</span><span class="n">T</span><span class="p">:</span> <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">n</span><span class="p">.</span><span class="nb">id</span> <span class="ow">in</span> <span class="n">d</span><span class="p">.</span><span class="n">F</span><span class="p">:</span> <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="bp">False</span>
    <span class="n">C</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">sl</span><span class="p">,</span> <span class="n">sp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">pc</span><span class="p">,</span> <span class="n">nc</span> <span class="ow">in</span> <span class="n">n</span><span class="p">.</span><span class="n">childs</span><span class="p">:</span>
      <span class="n">nc</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">_do</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">b</span><span class="p">:</span>
        <span class="n">C</span> <span class="o">|=</span> <span class="p">{(</span><span class="n">nc</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">pc</span><span class="p">)}</span>
        <span class="n">sl</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">sp</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">C</span> <span class="o">|=</span> <span class="p">{(</span><span class="n">nc</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">pc</span><span class="p">)}</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">sl</span><span class="p">,</span> <span class="n">sp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Node</span><span class="p">(</span><span class="n">n</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">n</span><span class="p">.</span><span class="n">stmts</span><span class="p">,</span> <span class="n">C</span><span class="p">),</span> <span class="bp">True</span>
  <span class="k">return</span> <span class="n">_do</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>

<p>A counterfactual is a statement about a <em>subjunctive</em> (possible or imagined) event that could’ve happened had the stochastic process taken a different course during its realization. Example (arrows mean we’re imposing a value):</p>

\[P(R_{T\leftarrow0}=1|T\leftarrow1;R=1)\]

<p>In the real world, “I have taken the treatment and recovered.”
What is the probability of “recovering,” had “I not taken the treatment” instead?</p>

<p><img src="http://www.adaptiveagents.org/_media/wiki/cf.png" alt="Counterfactual" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">counterfact</span><span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="n">Node</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span><span class="n">Node</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span><span class="n">MinCut</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
  <span class="s">'''P(Ac|B) :: proba of A given B and if C was made true instead.

  @param n: reference proba tree
  @param m: factual premise tree
  @param d: counterfactual event
  @return root of the new (counterfactual) proba tree
  '''</span>
  <span class="k">def</span> <span class="nf">_counterfact</span><span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="n">Node</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span><span class="n">Node</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span><span class="n">MinCut</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">m</span><span class="p">.</span><span class="nb">id</span> <span class="ow">in</span> <span class="n">d</span><span class="p">.</span><span class="n">T</span><span class="p">:</span> <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">m</span><span class="p">.</span><span class="nb">id</span> <span class="ow">in</span> <span class="n">d</span><span class="p">.</span><span class="n">F</span><span class="p">:</span> <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="bp">False</span>
    <span class="n">is_critical_bifurcation</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">C</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">pn</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="p">(</span><span class="n">pm</span><span class="p">,</span> <span class="n">mc</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">n</span><span class="p">.</span><span class="n">childs</span><span class="p">,</span> <span class="n">m</span><span class="p">.</span><span class="n">childs</span><span class="p">):</span>
      <span class="n">nn</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">_counterfact</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">mc</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">b</span><span class="p">:</span> <span class="n">is_critical_bifurcation</span> <span class="o">=</span> <span class="bp">True</span>
      <span class="n">C</span> <span class="o">|=</span> <span class="p">{(</span><span class="n">pm</span><span class="p">,</span> <span class="n">nn</span><span class="p">)}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_critical_bifurcation</span><span class="p">:</span>
      <span class="n">n</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">m</span><span class="p">.</span><span class="n">stmt</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="bp">True</span>
  <span class="k">return</span> <span class="n">_counterfact</span><span class="p">(</span><span class="n">do</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">m</span><span class="p">,</span> <span class="n">d</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>

<p>Normalize or assume some other measure (above - uniform) if total subtree probability is zero.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">norm</span><span class="p">(</span>
    <span class="n">D</span><span class="p">:</span><span class="n">Iterable</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Node</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">]],</span>
    <span class="n">sl</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">sp</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">sp</span><span class="p">:</span> <span class="k">return</span> <span class="p">{(</span><span class="n">p</span><span class="o">/</span><span class="n">sp</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">D</span><span class="p">}</span>
  <span class="k">return</span> <span class="p">{(</span><span class="n">l</span><span class="o">/</span><span class="n">sl</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">D</span><span class="p">}</span>
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<blockquote>
  <p>Unlike Pearl, who grounds the semantics of causal relations on the notion of interventions,
Shafer considered causality as a side-effect entirely subsumed under conditional independenece.
(…) Formalization of counterfactuals is unique to this work.</p>
</blockquote>

<p>Future work could involve</p>
<ul>
  <li>extending to 1st order logic,</li>
  <li>exploring links to temporal logic and probabilistic programming,</li>
  <li>a framework akin to do-calculus (can a causal effect be estimated from observation alone?).</li>
</ul>


        </div>

        

        

        <nav class="page-pagination" role="navigation">
  
    <a class="page-previous" href="/to-the-jupyter-config-and-back">
      <h4 class="page-pagination-label">Previous</h4>
      <span class="page-pagination-title">
        <i class="fas fa-arrow-left"></i> To the Jupyter config and back

      </span>
    </a>
  

  
    <a class="page-next" href="/chomsky-v-functionalists">
      <h4 class="page-pagination-label">Next</h4>
      <span class="page-pagination-title">
        Language Wars
 <i class="fas fa-arrow-right"></i>
      </span>
    </a>
  
</nav>

      </div>
    </div>
  </article>
</main>

    <footer id="footer" class="site-footer">
  <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
<div class="social-icons"><a class="social-icon" href="https://twitter.com/tkukurin"><i class="fab fa-twitter-square fa-2x" title="Twitter"></i></a><a class="social-icon" href="https://github.com/tkukurin"><i class="fab fa-github-square fa-2x" title="GitHub"></i></a><a class="social-icon" href="https://www.linkedin.com/in/toni/"><i class="fab fa-linkedin fa-2x" title="LinkedIn"></i></a></div><div class="copyright">
    
      

    
  </div>
</footer>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script>


<!-- MathJax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  </body>

</html>
