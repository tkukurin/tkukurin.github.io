<!DOCTYPE html>
<!--
    So Simple Jekyll Theme 3.2.0
    Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
    Free for personal and commercial use under the MIT license
    https://github.com/mmistakes/so-simple-theme/blob/master/LICENSE
-->
<html lang="en-US" class="no-js">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  

  
    <title>Building Athens Research (Clojure/JS)</title>
    <meta name="description" content="I have no idea how Clojure frontend works. This is a writeup process of me trying to figure out how to build Athens.">
    <link rel="canonical" href="https://tkukurin.github.io/athens-npm-clojure">
  

  <script>
    /* Cut the mustard */
    if ( 'querySelector' in document && 'addEventListener' in window ) {
      document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + 'js';
    }
  </script>

  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/skins/light.css">
  <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

</head>


  <body class="layout--post  building-athens-research-clojure-js">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#primary-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

    <header class="masthead">
  <div class="wrap">
    
    
    
      
        <div class="site-title animated fadeIn"><a href="/">~</a></div>
      
      <p class="site-description animated fadeIn" itemprop="description">caveat emptor</p>
    
  </div>
</header><!-- /.masthead -->


    <main id="main" class="main-content" aria-label="Content">
  <article class="h-entry">
    

    <div class="page-wrapper">
      <div class="page-sidebar">
        
            
            <h1 id="page-title" class="page-title p-name">Building Athens Research (Clojure/JS)
</h1>
        
        <div class="page-author h-card p-author"><div class="author-info">
    <time class="page-date dt-published" datetime="2021-04-13T00:00:00+00:00"><a class="u-url" href="">Apr 13, 2021</a>
</time>

  </div>
</div>

        

        
  <h3 class="page-taxonomies-title">Tags</h3>
  <ul class="page-taxonomies"><li class="page-taxonomy">tools</li>
  </ul>


      </div>

      <div class="page-content">
        <div class="e-content">
          <p>I have no idea how Clojure frontend works.
This is a writeup process of me trying to figure out how to build
<a href="https://github.com/athensresearch/athens">Athens</a>.</p>

<h2 id="tooling">Tooling</h2>

<p>Athens is a Roam-like opensource personal knowledge base written in Clojure and
compiled via <a href="https://shadow-cljs.github.io/docs/UsersGuide.html">shadow-cljs</a>
which is like a Clojure-to-JS transpiler (?)
consisting of <a href="https://github.com/thheller/shadow-cljs">a JAR</a>
and an <code class="language-plaintext highlighter-rouge">npm</code> interface.
Cf. <a href="https://clojure.org/about/clojurescript">ClojureScript</a>
and <a href="https://github.com/athensresearch/athens/tree/688d5b1a36b5a13c635430d7d364d52d9dbe410d/src/cljs/athens">initial Athens commit</a>.</p>

<p>Apparently you’ll also need <a href="https://leiningen.org/">Leiningen</a>
which is some dependency/config/project manager for Clojure.</p>
<blockquote>
  <p>Leiningen manages projects for you. Lein takes care of pulling in dependencies
(including Clojure itself), running the REPL, running your program and its
tests, packaging your program for distribution, and other administrative tasks</p>
</blockquote>

<h2 id="building">Building</h2>

<p>First install required dependencies via Node using <code class="language-plaintext highlighter-rouge">npm install</code>.
<a href="https://github.com/athensresearch/athens/commit/0eef6e234aa50c9c1d56a0f6c808006eb6093e5c">Current Athens commit</a>
has conflicting deps and produces scary messages like:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Could not resolve dependency:
peer react@"&gt;=16.13.1" from react-kapsule@2.2.1
</code></pre></div></div>

<p>So hack around this by setting <a href="https://github.com/athensresearch/athens/blob/0eef6e234aa50c9c1d56a0f6c808006eb6093e5c/package.json#L70"><code class="language-plaintext highlighter-rouge">package.json</code></a>
to <code class="language-plaintext highlighter-rouge">"&gt;=16.9.0"</code> and hope it doesn’t break anything.</p>

<p>Then use <code class="language-plaintext highlighter-rouge">npm execute</code> alias <code class="language-plaintext highlighter-rouge">npx shadow-cljs</code> (which will auto-download the
<code class="language-plaintext highlighter-rouge">shadow-cljs</code> binary) to build the actual app.
Builds are described using <a href="https://learnxinyminutes.com/docs/edn/">EDN format</a>.
E.g. <code class="language-plaintext highlighter-rouge">npx shadow-cljs release app</code> will transpile the Clojure code into
<code class="language-plaintext highlighter-rouge">resources/public/js/compiled/app.js</code> as per <a href="https://github.com/athensresearch/athens/blob/688d5b1a36b5a13c635430d7d364d52d9dbe410d/shadow-cljs.edn">this config</a>.</p>

<p>Useful commands:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npx shadow-cljs <span class="nb">help</span>
<span class="nv">$ </span>npx shadow-cljs compile app
<span class="nv">$ </span>npx shadow-cljs start
</code></pre></div></div>

<p>Starting the <code class="language-plaintext highlighter-rouge">shadow-cljs</code> server apparently also runs some sort of build
front-end on <code class="language-plaintext highlighter-rouge">localhost:9630</code>.</p>

<p>After compiling <code class="language-plaintext highlighter-rouge">app</code> and heading to <code class="language-plaintext highlighter-rouge">localhost:3000</code>, things should work.</p>


        </div>

        

        

        <nav class="page-pagination" role="navigation">
  
    <a class="page-previous" href="/emacs">
      <h4 class="page-pagination-label">Previous</h4>
      <span class="page-pagination-title">
        <i class="fas fa-arrow-left"></i> Emacs config

      </span>
    </a>
  

  
    <a class="page-next" href="/storing-episodic-memory">
      <h4 class="page-pagination-label">Next</h4>
      <span class="page-pagination-title">
        Storing episodic memory: place and grid cells
 <i class="fas fa-arrow-right"></i>
      </span>
    </a>
  
</nav>

      </div>
    </div>
  </article>
</main>

    <footer id="footer" class="site-footer">
  <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
<div class="social-icons"><a class="social-icon" href="https://twitter.com/tkukurin"><i class="fab fa-twitter-square fa-2x" title="Twitter"></i></a><a class="social-icon" href="https://github.com/tkukurin"><i class="fab fa-github-square fa-2x" title="GitHub"></i></a><a class="social-icon" href="https://www.linkedin.com/in/toni/"><i class="fab fa-linkedin fa-2x" title="LinkedIn"></i></a></div><div class="copyright">
    
      

    
  </div>
</footer>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script>


<!-- MathJax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  </body>

</html>
